# 非機能要件

## インフラストラクチャ要件

### Azure構成

#### リージョン
- **デプロイ先:** Azure 東日本リージョン (Japan East)

#### Azure Functions
- **プラン:** Consumption Plan（従量課金プラン）
- **説明:** 実行時間とリソース消費量に応じて課金される、サーバーレス実行環境

#### 開発言語・ランタイム
- **言語:** Python
- **バージョン:** 3.11

---

## パフォーマンス要件

### レスポンス時間
- **目標:** 5秒以内
- **測定範囲:** リクエスト受信から、レスポンス返却まで
- **対象:** 掛け算API、割り算APIの両方

### スケーラビリティ
- Consumption Planの自動スケーリング機能を利用
- 同時実行数の上限設定は不要

---

## ロギング要件

### ログ出力内容

#### リクエスト情報
以下の情報をログに記録すること:
- リクエストのタイムスタンプ
- 呼び出されたAPI（multiply または divide）
- HTTPメソッド（GET または POST）
- 入力パラメータ（A, B）
- リクエスト元のIPアドレス（可能な場合）

#### エラー詳細
エラー発生時に以下の情報をログに記録すること:
- エラーのタイムスタンプ
- エラーの種類（パラメータ未指定、数値以外、ゼロ除算など）
- エラーメッセージ
- 入力された値（エラーの原因となった値）
- スタックトレース（予期しないエラーの場合）

### ログレベル
- **INFO:** 正常なリクエスト処理
- **WARNING:** 入力値のバリデーションエラー
- **ERROR:** 予期しないシステムエラー

### ログ出力先
- Azure Functions の標準ログ機能を使用
- Application Insights への自動連携（Consumption Plan のデフォルト設定）

---

## テスト要件

### 単体テスト

#### カバレッジ目標
- **目標カバレッジ:** 80%以上
- **測定対象:** src/配下のPythonコード
- **測定基準:** ステートメントカバレッジ

#### テスト対象
- 各APIの関数（multiply, divide）
- パラメータのバリデーション処理
- エラーハンドリングロジック
- 計算ロジック

#### テストケース
以下のテストケースを含むこと:
- 正常系: 有効な入力値での計算
- 異常系: パラメータ未指定
- 異常系: 数値以外の入力
- 異常系: ゼロ除算（割り算APIのみ）
- 異常系: 負の数の入力
- 境界値: 非常に小さい値、非常に大きい値

---

### 統合テスト

#### テスト対象
- エンドツーエンドのAPI呼び出し
- GETメソッドでのリクエスト
- POSTメソッドでのリクエスト
- HTMLレスポンスの形式

#### テスト環境
- ローカル開発環境での実行
- Azure Functions Core Tools を使用

#### テストケース
- 各APIエンドポイントに対するHTTPリクエスト
- 正常系: 計算結果が正しくHTMLで返されること
- 異常系: 各エラーケースで適切なエラーメッセージが返されること
- レスポンスタイムの確認（5秒以内）

---

## セキュリティ要件

### 認証・認可
- **認証:** 不要（パブリックアクセス）
- **認可:** 不要
- **説明:** 学習用APIのため、認証機能は実装しない

### データ保護
- 入力データの永続化は行わない
- 個人情報は扱わない

### 最小限の実装
- Azure Functions の基本的なセキュリティ設定のみ使用
- HTTPS通信（Azure Functionsのデフォルト）
- 追加のセキュリティ機能は実装しない

---

## 運用要件

### デプロイ
- **方法:** 手動デプロイ
- **ツール:** Azure Portal、Azure CLI、またはVS Code拡張機能
- **CI/CDパイプライン:** 不要

### 監視・アラート
- **監視ダッシュボード:** 不要
- **アラート設定:** 不要
- **説明:** Application Insightsの基本的なログ記録のみ使用

### バックアップ・リカバリ
- 不要（ステートレスなAPIのため）

### ドキュメント
- README.md にローカル開発環境のセットアップ手順を記載
- 本ドキュメント（requirements.md, nonrequirements.md）を維持

---

## 開発環境要件

### 必要なツール
- Python 3.11
- Azure Functions Core Tools
- Visual Studio Code（推奨）
- Azure Functions 拡張機能（推奨）

### ローカル開発
- `local.settings.json` でローカル設定を管理
- `func start` でローカル実行が可能なこと

### 依存関係管理
- `requirements.txt` で依存パッケージを管理
- 最小限のパッケージのみ使用
